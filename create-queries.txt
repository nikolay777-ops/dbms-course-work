CREATE TABLE "users" (
  "id" SERIAL PRIMARY KEY,
  "first_name" VARCHAR(50),
  "last_name" VARCHAR(50),
  "email" VARCHAR(100) UNIQUE,
  "password" VARCHAR(100),
  "contact_num" VARCHAR(15),
  "role_id" BIGINT,
  "age" INT
);

CREATE TABLE "user_roles" (
  "id" SERIAL PRIMARY KEY,
  "name" VARCHAR(50)
);

CREATE TABLE "movies" (
  "id" SERIAL PRIMARY KEY,
  "title" VARCHAR(100),
  "description" TEXT,
  "release_date" DATE,
  "rating" DECIMAL(2,1),
  "duration" INTERVAL,
  "genre_id" BIGINT,
  "country_id" BIGINT,
  "age_restriction_id" BIGINT
);

CREATE TABLE "movie_director" (
  "id" SERIAL PRIMARY KEY,
  "movie_id" BIGINT,
  "director_id" BIGINT
);

CREATE TABLE "genres" (
  "id" SERIAL PRIMARY KEY,
  "name" VARCHAR(50)
);

CREATE TABLE "directors" (
  "id" SERIAL PRIMARY KEY,
  "first_name" VARCHAR(50),
  "last_name" VARCHAR(50)
);

CREATE TABLE "actors" (
  "id" SERIAL PRIMARY KEY,
  "first_name" VARCHAR(50),
  "last_name" VARCHAR(50)
);

CREATE TABLE "cinemas" (
  "id" SERIAL PRIMARY KEY,
  "name" VARCHAR(100),
  "address" VARCHAR(200)
);

CREATE TABLE "halls" (
  "id" SERIAL PRIMARY KEY,
  "cinema_id" INT,
  "hall_num" INT,
  "capacity" INT
);

CREATE TABLE "seats" (
  "id" SERIAL PRIMARY KEY,
  "hall_id" INT,
  "row_num" INT,
  "seat_num" INT,
  "seat_type_id" INT
);

CREATE TABLE "showtimes" (
  "id" SERIAL PRIMARY KEY,
  "movie_id" INT,
  "hall_id" INT,
  "startime" TIMESTAMP
);

CREATE TABLE "tickets" (
  "id" SERIAL PRIMARY KEY,
  "showtime_id" INT,
  "seat_id" INT,
  "price" DECIMAL(5,2)
);

CREATE TABLE "reservations" (
  "id" SERIAL PRIMARY KEY,
  "reservation_time" TIMESTAMP
);

CREATE TABLE "online_movies" (
  "id" SERIAL PRIMARY KEY,
  "movie_id" INT,
  "language_id" BIGINT,
  "url" TEXT,
  "created_at" TIMESTAMP,
  "updated_at" TIMESTAMP
);

CREATE TABLE "views" (
  "id" SERIAL PRIMARY KEY,
  "online_movie_id" INT,
  "view_time" TIMESTAMP,
  "view_dur_time" INTERVAL,
  "user_id" BIGINT
);

CREATE TABLE "reviews" (
  "id" SERIAL PRIMARY KEY,
  "movie_id" INT,
  "rating" INT,
  "comment" TEXT,
  "created_at" TIMESTAMP,
  "updated_at" TIMESTAMP
);

CREATE TABLE "payments" (
  "id" SERIAL PRIMARY KEY,
  "reservation_id" INT,
  "payment_method_id" BIGINT,
  "created_at" TIMESTAMP,
  "amount" DECIMAL(5,2)
);

CREATE TABLE "payment_methods" (
  "id" SERIAL PRIMARY KEY,
  "name" VARCHAR(50) UNIQUE
);

CREATE TABLE "advertisements" (
  "id" SERIAL PRIMARY KEY,
  "title" VARCHAR(100),
  "description" TEXT,
  "url" TEXT,
  "type_id" BIGINT
);

CREATE TABLE "adv_type" (
  "id" SERIAL PRIMARY KEY,
  "name" VARCHAR(50) UNIQUE
);

CREATE TABLE "ad_views" (
  "id" SERIAL PRIMARY KEY,
  "adv_id" INT,
  "view_id" INT,
  "time" TIMESTAMP
);

CREATE TABLE "countries" (
  "id" SERIAL PRIMARY KEY,
  "name" VARCHAR(50) UNIQUE
);

CREATE TABLE "languages" (
  "id" SERIAL PRIMARY KEY,
  "name" VARCHAR(50) UNIQUE
);

CREATE TABLE "age_restrictions" (
  "id" SERIAL PRIMARY KEY,
  "age_restriction" INT UNIQUE
);

CREATE TABLE "seat_types" (
  "id" SERIAL PRIMARY KEY,
  "name" VARCHAR(50) UNIQUE
);

CREATE TABLE "movie_actor" (
  "id" SERIAL PRIMARY KEY,
  "movie_id" BIGINT,
  "actor_id" BIGINT
);

CREATE TABLE "movie_genre" (
  "id" SERIAL PRIMARY KEY,
  "movie_id" BIGINT,
  "genre_id" BIGINT
);

CREATE TABLE "playlist" (
  "id" SERIAL PRIMARY KEY,
  "user_id" BIGINT,
  "name" VARCHAR(50)
);

CREATE TABLE "playlist_movies" (
  "id" SERIAL PRIMARY KEY,
  "movie_id" BIGINT,
  "playlist_id" BIGINT,
  "created_at" TIMESTAMP
);

CREATE TABLE "recommendation" (
  "id" SERIAL PRIMARY KEY,
  "user_id" BIGINT,
  "movie_id" BIGINT,
  "created_at" TIMESTAMP
);

ALTER TABLE "users" ADD FOREIGN KEY ("role_id") REFERENCES "user_roles" ("id");
ALTER TABLE "online_movies" ADD FOREIGN KEY ("language_id") REFERENCES "languages" ("id");
ALTER TABLE "movies" ADD FOREIGN KEY ("age_restriction_id") REFERENCES "age_restrictions" ("id");
ALTER TABLE "payments" ADD FOREIGN KEY ("payment_method_id") REFERENCES "payments" ("id");
ALTER TABLE "seats" ADD FOREIGN KEY ("seat_type_id") REFERENCES "seat_types" ("id");
ALTER TABLE "recommendation" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");
ALTER TABLE "advertisements" ADD FOREIGN KEY ("type_id") REFERENCES "adv_type" ("id");

ALTER TABLE "halls" ADD FOREIGN KEY ("cinema_id") REFERENCES "cinemas" ("id");

ALTER TABLE "seats" ADD FOREIGN KEY ("hall_id") REFERENCES "halls" ("id");

ALTER TABLE "showtimes" ADD FOREIGN KEY ("movie_id") REFERENCES "movies" ("id");

ALTER TABLE "showtimes" ADD FOREIGN KEY ("hall_id") REFERENCES "halls" ("id");

ALTER TABLE "tickets" ADD FOREIGN KEY ("showtime_id") REFERENCES "showtimes" ("id");

ALTER TABLE "tickets" ADD FOREIGN KEY ("seat_id") REFERENCES "seats" ("id");

ALTER TABLE "reservations" ADD FOREIGN KEY ("id") REFERENCES "users" ("id");

ALTER TABLE "online_movies" ADD FOREIGN KEY ("movie_id") REFERENCES "movies" ("id");

ALTER TABLE "views" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");

ALTER TABLE "views" ADD FOREIGN KEY ("online_movie_id") REFERENCES "online_movies" ("id");

ALTER TABLE "reviews" ADD FOREIGN KEY ("id") REFERENCES "users" ("id");

ALTER TABLE "reviews" ADD FOREIGN KEY ("movie_id") REFERENCES "movies" ("id");

ALTER TABLE "payments" ADD FOREIGN KEY ("reservation_id") REFERENCES "reservations" ("id");

ALTER TABLE "ad_views" ADD FOREIGN KEY ("adv_id") REFERENCES "advertisements" ("id");

ALTER TABLE "ad_views" ADD FOREIGN KEY ("view_id") REFERENCES "views" ("id");

ALTER TABLE "movie_actor" ADD FOREIGN KEY ("movie_id") REFERENCES "movies" ("id");

ALTER TABLE "movie_actor" ADD FOREIGN KEY ("actor_id") REFERENCES "actors" ("id");

ALTER TABLE "movie_genre" ADD FOREIGN KEY ("movie_id") REFERENCES "movies" ("id");

ALTER TABLE "movie_genre" ADD FOREIGN KEY ("genre_id") REFERENCES "genres" ("id");

ALTER TABLE "playlist_movies" ADD FOREIGN KEY ("playlist_id") REFERENCES "playlist" ("id");

ALTER TABLE "playlist_movies" ADD FOREIGN KEY ("movie_id") REFERENCES "movies" ("id");

ALTER TABLE "movie_director" ADD FOREIGN KEY ("movie_id") REFERENCES "movies" ("id");

ALTER TABLE "movie_director" ADD FOREIGN KEY ("director_id") REFERENCES "directors" ("id");

-- B-tree indexes
CREATE INDEX idx_users_email ON users USING btree(email);
CREATE INDEX idx_movies_title ON movies USING btree(title);
CREATE INDEX idx_showtimes_movie_id ON showtimes USING btree(movie_id);
CREATE INDEX idx_reviews_movie_id ON reviews USING btree(movie_id);

-- Hash index
CREATE INDEX idx_movies_title_hash ON movies USING hash(title);


-- Hash index
CREATE INDEX idx_movies_title_hash ON movies USING hash(title);

-- BRIN index
-- Assuming you have a column for timestamp in views table
CREATE INDEX idx_views_timestamp ON views USING brin(view_time);
